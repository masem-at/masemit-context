# masemIT Analytics - Project Context

> **AI Agent Quick Reference** | Last Updated: 2026-01-28 | v0.2.0

## What Is This?

Internal analytics dashboard aggregating web analytics from all masemIT projects into a single unified view. Replaces Vercel Analytics dependency with self-hosted solution.

## Tech Stack

| Component | Technology |
|-----------|------------|
| **Framework** | Next.js 16 (App Router) |
| **Language** | TypeScript 5 |
| **UI** | React 19 + Tailwind CSS 3.4 |
| **Database** | NeonDB (PostgreSQL 17, serverless) |
| **Hosting** | Vercel |
| **Analytics** | Self-hosted tracker.js |

## Projects Tracked

| Project | Domain | Color |
|---------|--------|-------|
| masem.at | www.masem.at | #0F2C55 |
| ChainSights | chainsights.one | #00E5C0 |
| tellingCube | tellingcube.com | #B84EFF |
| hoki.help | hoki.help | #FF6B6B |

## Architecture Overview

```
Browser → tracker.js → /api/events (POST) → NeonDB (events table)
                                                      ↓
Vercel Drains (legacy) → /api/ingest (POST) ─────────┤
                                                      ↓
Dashboard (RSC) ← Direct SQL queries ← events + daily_stats
```

**Key Patterns:**
- React Server Components query database directly (no intermediate API layer)
- Self-hosted tracker.js is primary data source
- Vercel Drains still supported (legacy, being phased out)
- Vienna timezone used for dashboard date filtering

## Directory Structure

```
masemit-analytics/
├── app/
│   ├── layout.tsx         # Root layout (dark theme, noindex)
│   ├── page.tsx           # Redirect to /dashboard
│   ├── dashboard/
│   │   ├── page.tsx       # Main dashboard (all projects)
│   │   ├── settings/      # Project settings page
│   │   └── [project]/     # Per-project detail view
│   ├── api/
│   │   ├── events/route.ts    # Event ingestion (tracker.js - primary)
│   │   ├── ingest/route.ts    # Event ingestion (Vercel Drains - legacy)
│   │   └── projects/[id]/route.ts  # Project management
│   └── components/        # React Components
│       ├── FilterBar.tsx      # Date range filter
│       ├── WorldMap.tsx       # Geographic visualization
│       ├── ProjectSettingsForm.tsx
│       └── RefreshButton.tsx
├── lib/
│   └── schema.sql         # PostgreSQL schema
├── public/
│   └── tracker.js         # Self-hosted analytics tracker
└── docs/                  # Project documentation
```

## Database Schema (Simplified)

```sql
-- Core tables
projects (id, name, domain, color, icon)
events (id, timestamp, project_id, type, path, country, device, utm_*, ...)

-- Events are partitioned quarterly: events_2026_q1, events_2026_q2, etc.
-- View: v_project_overview (aggregated stats)
```

## API Endpoints

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/api/events` | Receive events from tracker.js (primary) |
| GET | `/api/events?project=X&range=7d` | Query events |
| GET | `/api/projects/[id]` | Get project details |
| PATCH | `/api/projects/[id]` | Update project settings |
| POST | `/api/ingest` | Receive Vercel Drain events (legacy) |

## Environment Variables

```env
DATABASE_URL=           # NeonDB connection string
DRAIN_SECRET=           # Legacy: Vercel Drain HMAC secret
PROJECT_MASEMIT=        # Vercel project ID mappings (optional)
PROJECT_CHAINSIGHTS=
PROJECT_TELLINGCUBE=
PROJECT_HOKI=
```

## Current Status

- Self-hosted tracker.js deployed at analytics.masem.at
- All 4 projects integrated
- Event tracking working (pageView, custom events)
- Dashboard functional

## For AI Agents

**When working on this project:**

1. **Load first:** This file + `architecture.md`
2. **For features:** `data-models.md` + `api-contracts.md`
3. **For bugs:** `development-guide.md` + `source-tree-analysis.md`
4. **For frontend:** Check `app/dashboard/` and `components/`
5. **For backend:** Check `app/api/` and `lib/`

**Common tasks:**
- Add new event type → `app/api/events/route.ts`
- Add new metric → `lib/queries/` + dashboard component
- Track new project → Database + `PROJECT_*` env var

## Quick Commands

```bash
npm install          # Install dependencies
npm run dev          # Start dev server (localhost:3000)
npm run build        # Production build
npm run db:push      # Push schema to NeonDB
```

## Related Documentation

| Document | Description |
|----------|-------------|
| [index.md](./index.md) | Full documentation index |
| [architecture.md](./architecture.md) | Detailed system design |
| [api-contracts.md](./api-contracts.md) | API specifications |
| [data-models.md](./data-models.md) | Database schema & ERD |
| [development-guide.md](./development-guide.md) | Setup & workflows |

## Company Context

Part of **masemIT e.U.** internal tooling ecosystem.

---

*Generated by BMAD Tech Writer | masemIT e.U. 2026*
